<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sudoku DLX Bitset — Web Demo</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;max-width:960px;margin:2rem auto;padding:0 1rem;color:#111;background:#fafafa}
    .grid{display:grid;grid-template-columns:repeat(9,2.2rem);gap:2px;margin:1rem 0}
    input.cell{width:2.2rem;height:2.2rem;text-align:center;font-size:1.1rem;border:1px solid #ccc;background:#fff}
    button{padding:.6rem .9rem;margin-right:.5rem;border:0;border-radius:.5rem;background:#111;color:#fff;cursor:pointer}
    button.secondary{background:#555}
    .log{white-space:pre-wrap;background:#fff;border:1px solid #ddd;padding:.8rem;border-radius:.5rem}
    .foot{margin-top:1rem;color:#666;font-size:.9rem}
  </style>
</head>
<body>
  <h1>Sudoku DLX Bitset — Web Demo</h1>
  <p>Enter digits (1–9), leave blanks empty. Solve runs in your browser via <a href="https://pyodide.org/" target="_blank">Pyodide</a>.</p>
  <div id="grid" class="grid"></div>
  <div>
    <button id="solveBtn">Solve</button>
    <button id="clearBtn" class="secondary">Clear</button>
    <button id="sampleBtn" class="secondary">Load Sample</button>
  </div>
  <h3>Log</h3>
  <div id="log" class="log">Initializing solver worker...</div>
  <div class="foot">Algorithm: Exact cover (Algorithm X / DLX). Implementation © 2025 Stamatis-Christos Saridakis — MIT.</div>

  <script>
    const gridEl = document.getElementById('grid');
    const logEl = document.getElementById('log');
    const solveBtn = document.getElementById('solveBtn');
    const clearBtn = document.getElementById('clearBtn');
    const sampleBtn = document.getElementById('sampleBtn');
    function mkCell(){ const i=document.createElement('input'); i.className='cell'; i.maxLength=1; i.pattern='[1-9]'; i.inputMode='numeric'; return i; }
    for(let r=0;r<9;r++){ for(let c=0;c<9;c++){ gridEl.appendChild(mkCell()); }}

    function readGrid(){
      const v=[]; const cells=[...gridEl.querySelectorAll('input.cell')];
      for(let i=0;i<81;i++){ const ch=cells[i].value.trim(); v.push(ch?parseInt(ch,10):0); }
      return v;
    }
    function writeGrid(v){
      const cells=[...gridEl.querySelectorAll('input.cell')];
      for(let i=0;i<81;i++){ cells[i].value = v[i]?String(v[i]):''; }
    }

    const worker = new Worker(new URL('./worker.js', window.location.href), { type: 'classic' });

    function log(msg){ logEl.textContent = msg; }
    function setSolving(flag){ solveBtn.disabled = flag; solveBtn.textContent = flag ? 'Solving…' : 'Solve'; }

    worker.onmessage = (event)=>{
      const { type } = event.data || {};
      if (type === 'status') {
        log(event.data.message);
        return;
      }
      if (type === 'result') {
        setSolving(false);
        if (event.data.status === 'ok') {
          const timeMsg = typeof event.data.ms === 'number' ? `${event.data.ms.toFixed(2)} ms` : 'unknown time';
          if (event.data.solutions > 1) {
            log(`Multiple solutions (${event.data.solutions}). Showing one. Solved in ${timeMsg}.`);
          } else {
            log(`Solved in ${timeMsg}.`);
          }
          writeGrid(event.data.grid);
        } else if (event.data.status === 'none') {
          log('No solution (contradiction).');
        }
        return;
      }
      if (type === 'error') {
        setSolving(false);
        console.error('Worker error', event.data.detail || event.data.message);
        log(event.data.message || 'An unexpected error occurred.');
        return;
      }
    };

    worker.postMessage({ type: 'init' });

    solveBtn.onclick = ()=>{
      setSolving(true);
      log('Solving...');
      const v = readGrid();
      worker.postMessage({ type: 'solve', values: v });
    };
    clearBtn.onclick = ()=>{ writeGrid(Array(81).fill(0)); if (!solveBtn.disabled) { log('Cleared.'); } };
    sampleBtn.onclick = ()=>{
      const s=("53..7...."+"6..195..."+".98....6."+"8...6...3"+"4..8.3..1"+"7...2...6"+".6....28."+"...419..5"+"....8..79");
      const arr=[...s].map(ch=> ch==='.'?0:parseInt(ch,10));
      writeGrid(arr);
      if (!solveBtn.disabled) { log('Loaded sample.'); }
    };
  </script>
</body>
</html>
